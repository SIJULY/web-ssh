{% extends "layout.html" %}

{% block title %}仪表盘 - 服务器列表{% endblock %}

<style>
    /* 服务器列表样式 */
    .server-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 20px;
    }
    .server-card {
        background-color: #2a2a2a;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.4);
    }
    
    /* 【新】卡片头部：使用 flex 布局 */
    .server-card-header {
        display: flex;
        justify-content: space-between; /* 关键：名称在左，按钮在右 */
        align-items: center;
        margin-bottom: 10px; /* 头部和下方 p 标签的间距 */
    }
    .server-card-header h3 {
        margin: 0;
        color: #fff;
        word-break: break-all; /* 如果名称太长则换行 */
    }
    
    /* 【已修正】服务器信息 (p 标签) */
    .server-card p {
        color: #aaa;
        font-family: monospace;
        margin: 5px 0;
        word-break: break-all;
    }

    /* 【已修正】按钮组容器 */
    .server-actions {
        margin-top: 0; /* 不再需要上边距 */
        display: flex;
        gap: 10px;
        align-items: center;
        flex-shrink: 0; /* 防止按钮组被挤压换行 */
        margin-left: 15px; /* 在名称和按钮之间留出空间 */
    }
    
    /* 【已修正】按钮通用样式 */
    .btn-small {
        padding: 8px 12px;
        font-size: 14px;
        /* 移除 flex: 1 */
        text-align: center;
        text-decoration: none;
        white-space: nowrap; /* 防止按钮文字换行 */
    }
    .btn-edit {
        background-color: #ffc107;
        color: #212529;
    }
    .btn-edit:hover {
        background-color: #d39e00;
    }
    
    /* 【已修正】删除按钮的表单 */
    .btn-delete-form {
        margin: 0; /* 移除所有外边距 */
    }
    /* 【已修正】删除按钮本身 */
    .btn-delete {
        /* 移除 width: 100% */
        /* 样式将由 .btn, .btn-small, .btn-danger 共同提供 */
    }

    /* 当列表为空时的提示 */
    .empty-state {
        text-align: center;
        padding: 40px;
        background-color: #2a2a2a;
        border-radius: 8px;
    }
    .empty-state h3 { color: #fff; }
    .empty-state p { color: #aaa; }
    .empty-state .btn {
        display: inline-block;
        width: auto;
        padding: 12px 20px;
        margin-top: 10px;
    }

</style>

{% block content %}
    <h2>仪表盘</h2>
    
    {% if servers %}
        <div class="server-list">
            {% for server in servers %}
            <div class="server-card">
                <div class="server-card-header">
                    <h3>{{ server.name }}</h3>
                    
                    <div class="server-actions">
                        <a href="{{ url_for('terminal', server_id=server.id) }}" 
                           target="_blank" 
                           class="btn btn-small">连接</a>
                        
                        <a href="{{ url_for('edit_server', server_id=server.id) }}" 
                           class="btn btn-small btn-edit">编辑</a>
                        
                        <form action="{{ url_for('delete_server', server_id=server.id) }}" 
                              method="POST" 
                              class="btn-delete-form"
                              onsubmit="return confirm('您确定要删除 {{ server.name | e }} 吗？');">
                            <button type="submit" class="btn btn-small btn-danger btn-delete">删除</button>
                        </form>
                    </div>
                </div>
                
                <p>{{ server.username }}@{{ server.host }}:{{ server.port }}</p>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty-state">
            <h3>您还没有添加任何服务器。</h3>
            <p>点击下方按钮开始添加您的第一个 VPS。</p>
            <a href="{{ url_for('add_server') }}" class="btn">添加新服务器</a>
        </div>
    {% endif %}
    
{% endblock %}
