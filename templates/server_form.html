{% extends "layout.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="form-container">
    <h2>{{ title }}</h2>

    <form method="POST" action="">
        <div class="form-group">
            <label for="name">显示名称 (例如 "我的 Oracle VPS"):</label>
            <input type="text" id="name" name="name" value="{{ server.name | default('', true) }}" required>
        </div>
        
        <div class="form-group">
            <label for="host">主机 (IP 或域名):</label>
            <input type="text" id="host" name="host" value="{{ server.host | default('', true) }}" required>
        </div>

        <div class="form-group">
            <label for="port">端口:</label>
            <input type="number" id="port" name="port" value="{{ server.port | default('22', true) }}" required>
        </div>
        
        <div class="form-group">
            <label for="username">用户名 (例如 "root"):</label>
            <input type="text" id="username" name="username" value="{{ server.username | default('', true) }}" required>
        </div>
        
        <div class="form-group">
            <label>认证方式:</label>
            <div style="display: flex; gap: 20px;">
                <label>
                    <input type="radio" name="auth_method" value="password"
                           {% if not server or password_exists %}checked{% endif %} 
                           onchange="toggleAuth()"> 密码
                </label>
                <label>
                    <input type="radio" name="auth_method" value="key" 
                           {% if key_exists %}checked{% endif %} 
                           onchange="toggleAuth()"> 私钥
                </label>
            </div>
        </div>
        
        <div id="password-group">
            <div class="form-group">
                <label for="password">密码:</label>
                <input type="password" id="password" name="password" 
                       placeholder="{% if server %}留空则不更改密码{% else %}输入您的 SSH 密码{% endif %}">
            </div>
        </div>
        
        <div id="key-group">
            <div class="form-group">
                <label for="key_data">私钥:</label>
                <textarea id="key_data" name="key_data" 
                          placeholder="{% if server %}留空则不更改私钥{% else %}粘贴您的私钥 (例如 -----BEGIN RSA PRIVATE KEY-----){% endif %}"></textarea>
            </div>
        </div>
        
        <button type="submit" class="btn">保存服务器</button>
    </form>
</div>

<script>
    // 这个 JS 用于切换“密码”和“私钥”输入框的显示
    function toggleAuth() {
        var method = document.querySelector('input[name="auth_method"]:checked').value;
        if (method === 'password') {
            document.getElementById('password-group').style.display = 'block';
            document.getElementById('key-group').style.display = 'none';
        } else {
            document.getElementById('password-group').style.display = 'none';
            document.getElementById('key-group').style.display = 'block';
        }
    }
    // 页面加载时立即运行一次，以确保显示正确的输入框
    toggleAuth();
</script>
{% endblock %}
